<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Realtime Meeting</title>

    <style>
        body {
            font-family: Arial;
            background: #202124;
            color: white;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: #2b2b2b;
            padding: 40px;
            border-radius: 12px;
            width: 420px;
            text-align: center;
        }

        button {
            margin-top: 15px;
            padding: 12px;
            width: 100%;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .create {
            background: #1a73e8;
            color: white;
        }

        .join {
            background: #34a853;
            color: white;
        }

        input {
            width: 100%;
            padding: 10px;
            margin-top: 12px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>

    <div class="container">

        <h2>Realtime Meeting</h2>

        <!-- STEP 1 -->
        <div id="menu">
            <button class="create" onclick="showCreate()">
                âž• Create Room
            </button>

            <button class="join" onclick="showJoin()">
                ðŸ”— Join Room
            </button>
        </div>

        <!-- CREATE FORM -->
        <div id="createBox" class="hidden">
            <h3>Create Room</h3>
            <input id="createUsername" placeholder="Your username">
            <button class="create" onclick="createRoom()">Start Meeting</button>
            <button onclick="goBack()">â¬… Back</button>
        </div>

        <!-- JOIN FORM -->
        <div id="joinBox" class="hidden">
            <h3>Join Room</h3>
            <input id="joinUsername" placeholder="Your username">
            <input id="roomInput" placeholder="Room id">
            <button class="join" onclick="joinRoom()">Join</button>
            <button onclick="goBack()">â¬… Back</button>
        </div>


    </div>

    <script>

        function showCreate() {
            menu.classList.add("hidden");
            createBox.classList.remove("hidden");
        }

        function showJoin() {
            menu.classList.add("hidden");
            joinBox.classList.remove("hidden");
        }


        function goBack() {
            createBox.classList.add("hidden");
            joinBox.classList.add("hidden");
            menu.classList.remove("hidden");
        }

        async function createRoom() {
            const username =
                document.getElementById("createUsername").value.trim();

            if (!username) return alert("Enter your name");

            const res = await fetch("/rooms", { method: "POST" });
            const data = await res.json();

            accessRoom(data.room_id, username)
        }

        async function joinRoom() {
            const username =
                document.getElementById("joinUsername").value.trim();

            let value =
                document.getElementById("roomInput").value.trim();

            if (!username) return alert("Enter your name");
            if (!value) return alert("Enter room id");

            try {
                const res = await fetch(`/rooms/${value}/exists`);

                if (!res.ok) return alert("Invalid room id")

                const data = await res.json();

                if (!data.exists) return alert("Room not found")

                accessRoom(value, username);

            } catch (e) {
                alert("Server unavailable")
            }
        }


        function accessRoom(id, username) {
            window.location.href =
                `/room.html?room_id=${id}&username=${encodeURIComponent(username)}`;
        }

    </script>

</body>

</html>